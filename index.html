<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yamaguchi Halal Eats - Halal Food Delivery in Yamaguchi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" xintegrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        body { font-family: 'Inter', 'Noto Sans JP', sans-serif; background-color: #f8f9fa; }
        .hero-section { background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://images.unsplash.com/photo-1512152272829-e3139592d56f?q=80&w=2940&auto=format&fit=crop'); background-size: cover; background-position: center; }
        .menu-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .modal, .auth-modal, .checkout-modal, .success-modal, .admin-modal { transition: opacity 0.3s ease; }
        .modal-content, .auth-modal-content, .checkout-modal-content, .success-modal-content, .admin-modal-content { transition: transform 0.3s ease; }
        .calendar-day.preorder-day { cursor: pointer; }
        .calendar-day.preorder-day:hover { background-color: #d1fae5; }
        .calendar-day.selected { outline: 2px solid #10b981; outline-offset: 2px; background-color: #a7f3d0; }
        .auth-error { color: #ef4444; font-size: 0.875rem; margin-top: 0.5rem; text-align: center; }
        .lang-btn.active { background-color: #10b981; color: white; }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-40">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold text-green-600"><i class="fas fa-leaf mr-2"></i>Yamaguchi Halal Eats</div>
            <div class="hidden md:flex items-center space-x-4">
                <a href="#" data-key="homeLink" class="text-gray-600 hover:text-green-600">Home</a>
                <a href="#menu" data-key="menuLink" class="text-gray-600 hover:text-green-600">Our Menu</a>
                <a href="#how-to-order" data-key="howToOrderLink" class="text-gray-600 hover:text-green-600">How to Order</a>
                <a href="#about" data-key="aboutUsLink" class="text-gray-600 hover:text-green-600">About Us</a>
                
                <div class="w-px h-6 bg-gray-200"></div>

                <!-- Language Switcher -->
                <div id="language-switcher" class="flex items-center border border-gray-200 rounded-lg p-1">
                    <button data-lang="en" class="lang-btn text-sm font-semibold px-2 py-1 rounded-md">EN</button>
                    <button data-lang="ja" class="lang-btn text-sm font-semibold px-2 py-1 rounded-md">JA</button>
                    <button data-lang="id" class="lang-btn text-sm font-semibold px-2 py-1 rounded-md">ID</button>
                </div>
                
                <div class="w-px h-6 bg-gray-200"></div>

                <!-- Auth buttons -->
                <div id="auth-links" class="flex items-center space-x-2">
                    <button id="login-button" data-key="loginBtn" class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 text-sm">Log In</button>
                    <button id="signup-button" data-key="signupBtn" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300 text-sm">Sign Up</button>
                </div>
                <div id="user-links" class="hidden items-center space-x-4">
                    <span id="welcome-message" class="font-semibold text-sm"></span>
                    <button id="account-button" data-key="myAccountBtn" class="text-gray-600 hover:text-green-600 text-sm"><i class="fas fa-user-circle mr-1"></i>My Account</button>
                    <button id="logout-button" data-key="logoutBtn" class="text-gray-600 hover:text-green-600 text-sm"><i class="fas fa-sign-out-alt mr-1"></i>Log Out</button>
                </div>

                <button id="cart-button" class="relative text-gray-600 hover:text-green-600">
                    <i class="fas fa-shopping-cart text-xl"></i>
                    <span id="cart-count" class="absolute -top-2 -right-3 bg-green-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                </button>
            </div>
            <div class="md:hidden flex items-center space-x-4">
                 <button id="mobile-cart-button" class="relative text-gray-600 hover:text-green-600">
                    <i class="fas fa-shopping-cart text-2xl"></i>
                    <span id="mobile-cart-count" class="absolute -top-2 -right-3 bg-green-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                </button>
            </div>
        </nav>
    </header>

    <!-- Content Sections -->
    <section class="hero-section text-white py-20 md:py-32"><div class="container mx-auto px-6 text-center"><h1 data-key="heroTitle" class="text-4xl md:text-6xl font-bold mb-4"></h1><p data-key="heroSubtitle" class="text-lg md:text-xl mb-8"></p><div class="max-w-2xl mx-auto"><div class="relative"><input id="search-bar" type="text" data-key="searchPlaceholder" class="w-full py-4 px-6 rounded-full text-gray-800 focus:outline-none focus:ring-4 focus:ring-green-300"><button class="absolute right-2 top-1/2 -translate-y-1/2 bg-green-600 text-white rounded-full px-6 py-3 hover:bg-green-700 transition"><i class="fas fa-search"></i></button></div></div></div></section>
    <section id="calendar-section" class="bg-white py-16"><div class="container mx-auto px-6"><h2 data-key="calendarTitle" class="text-3xl font-bold text-center mb-4 text-gray-800"></h2><p data-key="calendarDesc" class="text-center text-gray-600 mb-8"></p><div class="max-w-3xl mx-auto bg-white p-4 sm:p-6 rounded-lg shadow-md"><div id="calendar-grid" class="grid grid-cols-7 gap-1 text-center"></div></div><div id="preorder-status" class="text-center mt-6 text-lg font-semibold text-green-700 h-8"></div></div></section>
    <main id="menu" class="container mx-auto px-6 py-16 pt-8"><h2 data-key="menuTitle" class="text-3xl font-bold text-center mb-12 text-gray-800"></h2><div id="menu-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"></div></main>
    <section id="how-to-order" class="bg-white py-16"><div class="container mx-auto px-6 text-center"><h2 data-key="howToOrderTitle" class="text-3xl font-bold text-center mb-12"></h2><div class="flex flex-col md:flex-row justify-center items-center space-y-8 md:space-y-0 md:space-x-12"><div class="text-center"><div class="bg-green-100 rounded-full h-24 w-24 flex items-center justify-center mx-auto mb-4"><i class="fas fa-mouse-pointer text-4xl text-green-600"></i></div><h3 data-key="step1Title" class="text-xl font-bold mb-2"></h3><p data-key="step1Desc" class="text-gray-600"></p></div><div class="text-center"><div class="bg-green-100 rounded-full h-24 w-24 flex items-center justify-center mx-auto mb-4"><i class="fas fa-shopping-cart text-4xl text-green-600"></i></div><h3 data-key="step2Title" class="text-xl font-bold mb-2"></h3><p data-key="step2Desc" class="text-gray-600"></p></div><div class="text-center"><div class="bg-green-100 rounded-full h-24 w-24 flex items-center justify-center mx-auto mb-4"><i class="fas fa-motorcycle text-4xl text-green-600"></i></div><h3 data-key="step3Title" class="text-xl font-bold mb-2"></h3><p data-key="step3Desc" class="text-gray-600"></p></div></div></div></section>
    <section id="about" class="bg-gray-100 py-16"><div class="container mx-auto px-6 text-center max-w-3xl"><h2 data-key="aboutTitle" class="text-3xl font-bold text-center mb-4"></h2><div class="text-center mb-8"><i class="fas fa-users text-4xl text-green-500"></i></div><h3 data-key="historyTitle" class="text-2xl font-semibold text-gray-800 mb-4"></h3><p data-key="historyDesc" class="text-gray-600 leading-relaxed"></p></div></section>
    
    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8"><div class="container mx-auto px-6 text-center"><p data-key="footerRights" class="mb-4"></p><button id="admin-panel-button" data-key="adminPanelBtn" class="text-sm text-gray-400 hover:text-white underline"></button></div></footer>

    <!-- Modals -->
    <div id="cart-sidebar" class="fixed top-0 right-0 h-full w-full max-w-md bg-white shadow-lg z-50 transform translate-x-full transition-transform duration-300 ease-in-out flex flex-col"><div class="p-6 border-b flex justify-between items-center"><h3 data-key="cartTitle" class="text-2xl font-bold"></h3><button id="close-cart-button" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button></div><div id="cart-items" class="p-6 overflow-y-auto flex-grow"><p id="empty-cart-message" data-key="cartEmpty" class="text-gray-500"></p></div><div class="p-6 border-t bg-gray-50"><div class="flex justify-between items-center mb-4"><span data-key="cartTotal" class="text-lg font-medium"></span><span id="cart-total" class="text-2xl font-bold">Â¥0</span></div><button id="checkout-button" data-key="checkoutBtn" class="w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition disabled:bg-gray-400"></button></div></div>
    <div id="checkout-modal" class="checkout-modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden"><div id="checkout-modal-content" class="checkout-modal-content bg-white rounded-lg shadow-xl w-full max-w-lg max-h-[90vh] flex flex-col transform scale-95"><div class="p-6 border-b flex justify-between items-center"><h3 data-key="checkoutModalTitle" class="text-2xl font-bold"></h3><button id="close-checkout-modal-button" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button></div><form id="checkout-form" class="p-6 overflow-y-auto" novalidate><h4 data-key="yourInfoTitle" class="text-lg font-semibold mb-4"></h4><div class="space-y-4"><div><label for="customer-name" data-key="nameLabel" class="block text-sm font-medium text-gray-700"></label><input type="text" id="customer-name" name="name" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"></div><div><label for="customer-phone" data-key="phoneLabel" class="block text-sm font-medium text-gray-700"></label><input type="tel" id="customer-phone" name="phone" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"></div><div><label for="customer-email" data-key="emailLabel" class="block text-sm font-medium text-gray-700"></label><input type="email" id="customer-email" name="email" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500" readonly></div><div><label for="customer-address" data-key="addressLabel" class="block text-sm font-medium text-gray-700"></label><textarea id="customer-address" name="address" rows="3" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"></textarea></div></div><div id="form-error" data-key="formError" class="text-red-500 text-sm mt-4 hidden"></div><div class="mt-6 border-t pt-4"><div class="flex justify-between items-center text-lg"><span data-key="totalPaymentLabel"></span><span id="checkout-total" class="font-bold text-xl"></span></div></div></form><div class="p-6 bg-gray-50 border-t"><button type="submit" id="confirm-order-button" data-key="confirmOrderBtn" form="checkout-form" class="w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition disabled:opacity-75"></button></div></div></div>
    <div id="success-modal" class="success-modal fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 hidden"><div class="bg-white rounded-lg shadow-xl w-full max-w-sm text-center p-8"><div class="text-green-500 mb-4"><i class="fas fa-check-circle fa-4x"></i></div><h3 data-key="thankYouTitle" class="text-2xl font-bold mb-2"></h3><p data-key="thankYouDesc" class="text-gray-600 mb-6"></p><button id="close-success-modal-button" data-key="closeBtn" class="w-full bg-green-600 text-white py-2 rounded-lg font-semibold hover:bg-green-700 transition"></button></div></div>
    <div id="admin-modal" class="admin-modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden"><div class="admin-modal-content bg-white rounded-lg shadow-xl w-full max-w-4xl h-[90vh] flex flex-col transform scale-95"><div class="p-6 border-b flex justify-between items-center"><h3 class="text-2xl font-bold">Order Management Panel</h3><button id="close-admin-modal-button" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button></div><div id="order-list" class="p-6 overflow-y-auto bg-gray-100 flex-grow"><p class="text-center text-gray-500">No orders yet.</p></div></div></div>
    <div id="signup-modal" class="auth-modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden"><div class="auth-modal-content bg-white rounded-lg shadow-xl w-full max-w-md transform scale-95"><div class="p-6 border-b flex justify-between items-center"><h3 data-key="createAccountTitle" class="text-2xl font-bold"></h3><button id="close-signup-modal-button" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button></div><form id="signup-form" class="p-6 space-y-4" novalidate><div><label for="signup-name" data-key="nameLabel" class="block text-sm font-medium text-gray-700"></label><input type="text" id="signup-name" required class="mt-1 block w-full px-3 py-2 rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"></div><div><label for="signup-email" data-key="emailLabel" class="block text-sm font-medium text-gray-700"></label><input type="email" id="signup-email" required class="mt-1 block w-full px-3 py-2 rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"></div><div><label for="signup-password" data-key="passwordLabel" class="block text-sm font-medium text-gray-700"></label><input type="password" id="signup-password" required minlength="6" class="mt-1 block w-full px-3 py-2 rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"></div><div id="signup-error" class="auth-error hidden"></div><div class="pt-2"><button type="submit" data-key="signupBtn" class="w-full bg-green-600 text-white py-2 rounded-lg font-bold hover:bg-green-700"></button></div></form></div></div>
    <div id="login-modal" class="auth-modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden"><div class="auth-modal-content bg-white rounded-lg shadow-xl w-full max-w-md transform scale-95"><div class="p-6 border-b flex justify-between items-center"><h3 data-key="loginTitle" class="text-2xl font-bold"></h3><button id="close-login-modal-button" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button></div><form id="login-form" class="p-6 space-y-4" novalidate><div><label for="login-email" data-key="emailLabel" class="block text-sm font-medium text-gray-700"></label><input type="email" id="login-email" required class="mt-1 block w-full px-3 py-2 rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"></div><div><label for="login-password" data-key="passwordLabel" class="block text-sm font-medium text-gray-700"></label><input type="password" id="login-password" required class="mt-1 block w-full px-3 py-2 rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"></div><div id="login-error" class="auth-error hidden"></div><div class="pt-2"><button type="submit" data-key="loginBtn" class="w-full bg-green-600 text-white py-2 rounded-lg font-bold hover:bg-green-700"></button></div></form></div></div>
    <div id="account-modal" class="auth-modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden"><div class="auth-modal-content bg-white rounded-lg shadow-xl w-full max-w-md transform scale-95"><div class="p-6 border-b flex justify-between items-center"><h3 data-key="myAccountTitle" class="text-2xl font-bold"></h3><button id="close-account-modal-button" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button></div><form id="account-form" class="p-6 space-y-4" novalidate><div><label for="account-name" data-key="nameLabel" class="block text-sm font-medium text-gray-700"></label><input type="text" id="account-name" required class="mt-1 block w-full px-3 py-2 rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"></div><div><label for="account-phone" data-key="phoneLabel" class="block text-sm font-medium text-gray-700"></label><input type="tel" id="account-phone" required class="mt-1 block w-full px-3 py-2 rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"></div><div><label for="account-address" data-key="addressLabel" class="block text-sm font-medium text-gray-700"></label><textarea id="account-address" rows="3" required class="mt-1 block w-full px-3 py-2 rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"></textarea></div><div id="account-success" data-key="profileUpdateSuccess" class="text-green-600 text-sm mt-2 text-center hidden"></div><div id="account-error" class="auth-error hidden"></div><div class="pt-2"><button type="submit" data-key="saveChangesBtn" class="w-full bg-green-600 text-white py-2 rounded-lg font-bold hover:bg-green-700"></button></div></form></div></div>

    <script type="module">
    // Firebase SDK Import
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
    
    const firebaseConfig = {
        apiKey: "AIzaSyBVH-Wr8v--A0uSn8Z82fFLdn_v6SZoT8Y",
        authDomain: "yamaguchi-halal-eats.firebaseapp.com",
        projectId: "yamaguchi-halal-eats",
        storageBucket: "yamaguchi-halal-eats.appspot.com",
        messagingSenderId: "471358397224",
        appId: "1:471358397224:web:46184a676f2b9b23860e1d",
        measurementId: "G-XKK7QMMWWN"
    };

    let db, auth;
    if (firebaseConfig.apiKey && firebaseConfig.apiKey !== "YOUR_API_KEY") {
      try { const app = initializeApp(firebaseConfig); db = getFirestore(app); auth = getAuth(app); }
      catch (e) { console.error("Error initializing Firebase:", e); }
    }
    
    // --- Translations & Data ---
    const translations = {
        en: { homeLink: "Home", menuLink: "Our Menu", howToOrderLink: "How to Order", aboutUsLink: "About Us", loginBtn: "Log In", signupBtn: "Sign Up", myAccountBtn: '<i class="fas fa-user-circle mr-1"></i>My Account', logoutBtn: '<i class="fas fa-sign-out-alt mr-1"></i>Log Out', heroTitle: "Authentic Halal Cuisine, Delivered to Your Door.", heroSubtitle: "We deliver our original Halal dishes with care, anywhere in Yamaguchi Prefecture.", searchPlaceholder: "Search for our dishes...", calendarTitle: "Pre-Order Calendar (July 2025)", calendarDesc: "Click a date on the calendar to select a pre-order day.<br>Only residents of the listed city can pre-order on that day.", menuTitle: "Our Signature Menu", addBtn: "Add", addedBtn: "Added", howToOrderTitle: "How to Order", step1Title: "1. Choose", step1Desc: "Select your favorite dishes from our menu.", step2Title: "2. Checkout", step2Desc: "Enter your details and confirm your order.", step3Title: "3. Enjoy", step3Desc: "Your delicious meal will be delivered to you.", aboutTitle: "About Us", historyTitle: "Our History", historyDesc: "This service was started by a Japanese and an Indonesian living together in Yamaguchi Prefecture. Our mission is to deliver authentic, delicious, and worry-free Halal meals to everyone who needs them in our community. We pour our hearts into every dish, hoping to bring you the comforting taste of home.", footerRights: "&copy; 2025 Yamaguchi Halal Eats. All Rights Reserved.", adminPanelBtn: "Admin Panel", cartTitle: "Shopping Cart", cartEmpty: "Your cart is empty.", cartTotal: "Total:", checkoutBtn: "Checkout", checkoutModalTitle: "Confirm Your Order", yourInfoTitle: "Your Information", nameLabel: "Full Name", phoneLabel: "Phone Number", emailLabel: "Email Address", addressLabel: "Delivery Address", formError: "Please fill in all fields.", totalPaymentLabel: "Total Payment:", confirmOrderBtn: "Confirm Order", thankYouTitle: "Thank You for Your Order!", thankYouDesc: "Your order has been successfully placed.", closeBtn: "Close", createAccountTitle: "Create Your Account", passwordLabel: "Password", loginTitle: "Log In to Your Account", myAccountTitle: "My Account", profileUpdateSuccess: "Profile updated successfully!", saveChangesBtn: "Save Changes", welcome: "Welcome", preorderYamaguchi: "Delivery for {date} is available for residents of Yamaguchi City. Please proceed with your order.", preorderUbe: "Delivery for {date} is available for residents of Ube City. Please proceed with your order.", dbError: "Database connection error. Order cannot be saved because Firebase is not configured.", orderError: "An error occurred while processing your order. Please try again.", passwordIncorrect: "Incorrect password." },
        ja: { homeLink: "ãã¼ã ", menuLink: "ã¡ãã¥ã¼", howToOrderLink: "æ³¨ææ¹æ³", aboutUsLink: "ç§ãã¡ã«ã¤ãã¦", loginBtn: "ã­ã°ã¤ã³", signupBtn: "æ°è¦ç»é²", myAccountBtn: '<i class="fas fa-user-circle mr-1"></i>ã¢ã«ã¦ã³ã', logoutBtn: '<i class="fas fa-sign-out-alt mr-1"></i>ã­ã°ã¢ã¦ã', heroTitle: "æ¬æ ¼ãã©ã¼ã«æçãããèªå®ã§ã", heroSubtitle: "å±±å£çåãã©ãã¸ã§ãçå¿ãè¾¼ãã¦ãå±ããã¾ãã", searchPlaceholder: "æçãæ¤ç´¢...", calendarTitle: "äºåæ³¨æã«ã¬ã³ãã¼ (2025å¹´7æ)", calendarDesc: "ã«ã¬ã³ãã¼ã®æ¥ä»ãã¯ãªãã¯ãã¦ãäºåæ³¨ææ¥ãé¸æãã¦ãã ããã<br>è¨è¼ãããå¸ã«ãä½ã¾ãã®æ¹ã®ã¿ããã®æ¥ã«äºåæ³¨æãå¯è½ã§ãã", menuTitle: "ç§ãã¡ã®ç¹è£½ã¡ãã¥ã¼", addBtn: "è¿½å ", addedBtn: "è¿½å æ¸ã¿", howToOrderTitle: "ãæ³¨ææ¹æ³", step1Title: "1. é¸ã¶", step1Desc: "ã¡ãã¥ã¼ãããå¥½ããªæçããé¸ã³ãã ããã", step2Title: "2. æ³¨æ", step2Desc: "ãå®¢æ§æå ±ãå¥åããæ³¨æãç¢ºå®ãã¾ãã", step3Title: "3. æ¥½ãã", step3Desc: "ç¾å³ãããæçããèªå®ã«å±ãã¾ãã", aboutTitle: "ç§ãã¡ã«ã¤ãã¦", historyTitle: "ç§ãã¡ã®æ­©ã¿", historyDesc: "ãã®ãµã¼ãã¹ã¯ãå±±å£çã«ä½ãæ¥æ¬äººã¨ã¤ã³ããã·ã¢äººã®äºäººãå§ãã¾ãããç§ãã¡ã®ä½¿å½ã¯ãæ¬æ ¼çã§ç¾å³ãããããã¦å®å¿ã§ãããã©ã¼ã«æçããå°åã®çæ§ã«ãå±ããããã¨ã§ããä¸ç¿ä¸ç¿ã«å¿ãè¾¼ãã¦ãæé·ã®å³ããå±ããã¾ãã", footerRights: "&copy; 2025 ãã¾ãã¡Halal Eats. All Rights Reserved.", adminPanelBtn: "ç®¡çèããã«", cartTitle: "ã·ã§ããã³ã°ã«ã¼ã", cartEmpty: "ã«ã¼ãã¯ç©ºã§ãã", cartTotal: "åè¨:", checkoutBtn: "ã¬ã¸ã«é²ã", checkoutModalTitle: "ãæ³¨æã®ç¢ºèª", yourInfoTitle: "ãå®¢æ§æå ±", nameLabel: "ãåå", phoneLabel: "é»è©±çªå·", emailLabel: "ã¡ã¼ã«ã¢ãã¬ã¹", addressLabel: "ééåä½æ", formError: "ãã¹ã¦ã®é ç®ãå¥åãã¦ãã ããã", totalPaymentLabel: "ãæ¯æãåè¨:", confirmOrderBtn: "æ³¨æãç¢ºå®ãã", thankYouTitle: "ãæ³¨æãããã¨ããããã¾ãï¼", thankYouDesc: "ãæ³¨æãæ­£å¸¸ã«å®äºãã¾ããã", closeBtn: "éãã", createAccountTitle: "ã¢ã«ã¦ã³ãä½æ", passwordLabel: "ãã¹ã¯ã¼ã", loginTitle: "ã¢ã«ã¦ã³ãã«ã­ã°ã¤ã³", myAccountTitle: "ãã¤ã¢ã«ã¦ã³ã", profileUpdateSuccess: "ãã­ãã£ã¼ã«ãæ´æ°ãã¾ããï¼", saveChangesBtn: "å¤æ´ãä¿å­", welcome: "ãããã", preorderYamaguchi: "ã{date}ãã¯ãå±±å£å¸ãã«ãä½ã¾ãã®æ¹ã®ééæ¥ã§ãããã®ã¾ã¾ãæ³¨æãã ããã", preorderUbe: "ã{date}ãã¯ãå®é¨å¸ãã«ãä½ã¾ãã®æ¹ã®ééæ¥ã§ãããã®ã¾ã¾ãæ³¨æãã ããã", dbError: "ãã¼ã¿ãã¼ã¹æ¥ç¶ã¨ã©ã¼ãFirebaseãè¨­å®ããã¦ããªããããæ³¨æãä¿å­ã§ãã¾ããã", orderError: "æ³¨æå¦çä¸­ã«ã¨ã©ã¼ãçºçãã¾ãããããä¸åº¦ãè©¦ããã ããã", passwordIncorrect: "ãã¹ã¯ã¼ããéãã¾ãã" },
        id: { homeLink: "Beranda", menuLink: "Menu Kami", howToOrderLink: "Cara Pesan", aboutUsLink: "Tentang Kami", loginBtn: "Masuk", signupBtn: "Daftar", myAccountBtn: '<i class="fas fa-user-circle mr-1"></i>Akun Saya', logoutBtn: '<i class="fas fa-sign-out-alt mr-1"></i>Keluar', heroTitle: "Masakan Halal Otentik, Diantar ke Pintu Anda.", heroSubtitle: "Kami mengantarkan hidangan Halal asli kami dengan hati-hati, ke mana saja di Prefektur Yamaguchi.", searchPlaceholder: "Cari hidangan kami...", calendarTitle: "Kalender Pra-Pesan (Juli 2025)", calendarDesc: "Klik tanggal di kalender untuk memilih hari pra-pesan.<br>Hanya penduduk kota yang terdaftar yang dapat melakukan pra-pesan pada hari itu.", menuTitle: "Menu Andalan Kami", addBtn: "Tambah", addedBtn: "Ditambahkan", howToOrderTitle: "Cara Memesan", step1Title: "1. Pilih", step1Desc: "Pilih hidangan favorit Anda dari menu kami.", step2Title: "2. Bayar", step2Desc: "Masukkan data Anda dan konfirmasi pesanan Anda.", step3Title: "3. Nikmati", step3Desc: "Makanan lezat Anda akan diantarkan ke rumah Anda.", aboutTitle: "Tentang Kami", historyTitle: "Sejarah Kami", historyDesc: "Layanan ini dimulai oleh seorang Jepang dan seorang Indonesia yang tinggal bersama di Prefektur Yamaguchi. Misi kami adalah untuk mengantarkan makanan Halal yang otentik, lezat, dan tanpa rasa khawatir kepada semua orang yang membutuhkannya di komunitas kami. Kami mencurahkan hati kami ke dalam setiap hidangan, dengan harapan dapat memberikan Anda rasa nyaman seperti di rumah sendiri.", footerRights: "&copy; 2025 Yamaguchi Halal Eats. Semua Hak Dilindungi.", adminPanelBtn: "Panel Admin", cartTitle: "Keranjang Belanja", cartEmpty: "Keranjang Anda kosong.", cartTotal: "Total:", checkoutBtn: "Bayar", checkoutModalTitle: "Konfirmasi Pesanan Anda", yourInfoTitle: "Informasi Anda", nameLabel: "Nama Lengkap", phoneLabel: "Nomor Telepon", emailLabel: "Alamat Email", addressLabel: "Alamat Pengiriman", formError: "Harap isi semua kolom.", totalPaymentLabel: "Total Pembayaran:", confirmOrderBtn: "Konfirmasi Pesanan", thankYouTitle: "Terima Kasih Atas Pesanan Anda!", thankYouDesc: "Pesanan Anda telah berhasil dilakukan.", closeBtn: "Tutup", createAccountTitle: "Buat Akun Anda", passwordLabel: "Kata Sandi", loginTitle: "Masuk ke Akun Anda", myAccountTitle: "Akun Saya", profileUpdateSuccess: "Profil berhasil diperbarui!", saveChangesBtn: "Simpan Perubahan", welcome: "Selamat Datang", preorderYamaguchi: "Pengiriman untuk {date} tersedia untuk penduduk Kota Yamaguchi. Silakan lanjutkan pesanan Anda.", preorderUbe: "Pengiriman untuk {date} tersedia untuk penduduk Kota Ube. Silakan lanjutkan pesanan Anda.", dbError: "Kesalahan koneksi database. Pesanan tidak dapat disimpan karena Firebase tidak dikonfigurasi.", orderError: "Terjadi kesalahan saat memproses pesanan Anda. Silakan coba lagi.", passwordIncorrect: "Kata sandi salah." }
    };
    const menuItems = [ { id: 1, name_en: "Halal Tonkotsu Ramen", name_ja: "ãã©ã¼ã«è±éª¨ã©ã¼ã¡ã³", name_id: "Ramen Tonkotsu Halal", price: 1250, description_en: "Our signature ramen with a rich, creamy pork-free broth, topped with chicken chashu, menma, and a seasoned egg.", description_ja: "å½åºèªæ¢ã®ã©ã¼ã¡ã³ãè±ãä½¿ããªãæ¿åã§ã¯ãªã¼ãã¼ãªã¹ã¼ãã«ãé¶ãã£ã¼ã·ã¥ã¼ãã¡ã³ããå³çããããã³ã°ãã¾ããã", description_id: "Ramen andalan kami dengan kaldu kaya krim bebas babi, dengan topping chashu ayam, menma, dan telur berbumbu.", imageUrl: "https://images.unsplash.com/photo-1612927601601-6638424737ce?q=80&w=2787&auto=format&fit=crop" }, { id: 2, name_en: "Nasi Goreng", name_ja: "ãã·ã´ã¬ã³", name_id: "Nasi Goreng", price: 1100, description_en: "Classic Indonesian fried rice with sweet soy sauce, chicken, and a fried egg on top.", description_ja: "å®çªã®ã¤ã³ããã·ã¢é¢¨ãã£ã¼ãã³ãçãé¤æ²¹ã¨é¶èã§çããç®çç¼ããä¹ãã¾ããã", description_id: "Nasi goreng klasik Indonesia dengan kecap manis, ayam, dan telur mata sapi di atasnya.", imageUrl: "https://images.unsplash.com/photo-1599602235011-95b62a773f77?q=80&w=2849&auto=format&fit=crop" }, { id: 3, name_en: "Chicken Satay (5 Skewers)", name_ja: "ãã­ã³ãµãã¼ï¼5æ¬ï¼", name_id: "Sate Ayam (5 Tusuk)", price: 800, description_en: "Tender, marinated chicken skewers, grilled to perfection and served with a rich peanut sauce.", description_ja: "æãããå³ä»ãããé¶èã®ä¸²ç¼ããé¦ã°ããç¼ãä¸ããæ¿åãªãã¼ãããã½ã¼ã¹ãæ·»ãã¦ã", description_id: "Sate ayam empuk yang direndam bumbu, dipanggang sempurna dan disajikan dengan saus kacang yang kaya.", imageUrl: "https://images.unsplash.com/photo-1626084469318-26122a751593?q=80&w=2940&auto=format&fit=crop" }, { id: 4, name_en: "Beef Rendang", name_ja: "ãã¼ãã»ã«ã³ãã³", name_id: "Rendang Sapi", price: 1600, description_en: "Slow-cooked beef in a fragrant mixture of coconut milk and spices until tender and flavorful.", description_ja: "çèãã³ã³ããããã«ã¯ã¨ã¹ãã¤ã¹ã§æããããªãã¾ã§ãã£ããç®è¾¼ãã ãé¢¨å³è±ããªä¸åã", description_id: "Daging sapi yang dimasak perlahan dalam campuran santan dan rempah-rempah yang harum hingga empuk dan beraroma.", imageUrl: "https://images.unsplash.com/photo-1626084474384-5893557a5fb2?q=80&w=2940&auto=format&fit=crop" }, { id: 5, name_en: "Halal Gyoza (6 pcs)", name_ja: "ãã©ã¼ã«é¤å­ï¼6åï¼", name_id: "Gyoza Halal (6 buah)", price: 650, description_en: "Pan-fried dumplings filled with minced chicken and vegetables, served with a soy-vinegar dipping sauce.", description_ja: "é¶ã²ãèã¨éèãè©°ããç¼ãé¤å­ãé¢é¤æ²¹ã®ç¹è£½ã ãã§ãå¬ãä¸ãããã ããã", description_id: "Pangsit goreng berisi ayam cincang dan sayuran, disajikan dengan saus celup cuka kedelai.", imageUrl: "https://images.unsplash.com/photo-1631783321568-9a35622fa22b?q=80&w=2787&auto=format&fit=crop" }, { id: 6, name_en: "Mango Lassi", name_ja: "ãã³ã´ã¼ã©ãã·ã¼", name_id: "Lassi Mangga", price: 500, description_en: "A refreshing and creamy yogurt drink blended with sweet, ripe mangoes.", description_ja: "çãçãããã³ã´ã¼ããã¬ã³ããããç½ããã§ã¯ãªã¼ãã¼ãªã¨ã¼ã°ã«ãããªã³ã¯ã", description_id: "Minuman yogurt krim yang menyegarkan dicampur dengan mangga matang yang manis.", imageUrl: "https://images.unsplash.com/photo-1626803364123-0176e053d231?q=80&w=2787&auto=format&fit=crop" } ];
    let cart = [];
    let selectedPreOrder = { date: null, city: null };
    let currentUser = null;
    let currentLang = 'en';
    
    // --- App Initialization & Main Logic ---
    document.addEventListener('DOMContentLoaded', () => {
        const dom = { menuList: document.getElementById('menu-list'), searchBar: document.getElementById('search-bar'), calendarGrid: document.getElementById('calendar-grid'), preorderStatus: document.getElementById('preorder-status'), cartButton: document.getElementById('cart-button'), mobileCartButton: document.getElementById('mobile-cart-button'), cartSidebar: document.getElementById('cart-sidebar'), closeCartButton: document.getElementById('close-cart-button'), cartItemsContainer: document.getElementById('cart-items'), cartTotalElement: document.getElementById('cart-total'), cartCountElements: [document.getElementById('cart-count'), document.getElementById('mobile-cart-count')], emptyCartMessage: document.getElementById('empty-cart-message'), checkoutButton: document.getElementById('checkout-button'), checkoutModal: document.getElementById('checkout-modal'), closeCheckoutModalButton: document.getElementById('close-checkout-modal-button'), checkoutForm: document.getElementById('checkout-form'), checkoutTotalElement: document.getElementById('checkout-total'), formError: document.getElementById('form-error'), successModal: document.getElementById('success-modal'), closeSuccessModalButton: document.getElementById('close-success-modal-button'), adminPanelButton: document.getElementById('admin-panel-button'), adminModal: document.getElementById('admin-modal'), closeAdminModalButton: document.getElementById('close-admin-modal-button'), orderListContainer: document.getElementById('order-list'), authLinks: document.getElementById('auth-links'), userLinks: document.getElementById('user-links'), welcomeMessage: document.getElementById('welcome-message'), signupModal: document.getElementById('signup-modal'), loginModal: document.getElementById('login-modal'), accountModal: document.getElementById('account-modal'), languageSwitcher: document.getElementById('language-switcher') };
        
        // --- Functions ---
        const showAuthError = (modal, message) => { const errorEl = document.getElementById(`${modal}-error`); errorEl.textContent = message; errorEl.classList.remove('hidden'); };
        const closeAuthModal = (modalId) => { const modal = document.getElementById(modalId); modal.classList.add('hidden'); modal.querySelector('.auth-modal-content').classList.add('scale-95'); document.body.style.overflow = 'auto'; };
        const openAuthModal = (modalId) => { const modal = document.getElementById(modalId); modal.classList.remove('hidden'); setTimeout(() => modal.querySelector('.auth-modal-content').classList.remove('scale-95'), 10); document.body.style.overflow = 'hidden'; };
        function updateLanguage(lang) { currentLang = lang; document.documentElement.lang = lang; document.querySelectorAll('[data-key]').forEach(el => { const key = el.dataset.key; if (translations[lang][key]) { if(el.placeholder) el.placeholder = translations[lang][key]; else el.innerHTML = translations[lang][key]; }}); document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.lang === lang)); renderMenu(menuItems); generateCalendar(2025, 7); localStorage.setItem('language', lang); }
        function generateCalendar(year, month) { dom.calendarGrid.innerHTML = ''; const monthIndex = month - 1; const firstDay = new Date(year, monthIndex, 1).getDay(); const daysInMonth = new Date(year, month, 0).getDate(); const weekDays = currentLang === 'ja' ? ['æ¥', 'æ', 'ç«', 'æ°´', 'æ¨', 'é', 'å'] : (currentLang === 'id' ? ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'] : ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']); weekDays.forEach(day => { const dayHeader = document.createElement('div'); dayHeader.className = 'font-bold text-gray-700 p-2'; dayHeader.textContent = day; dom.calendarGrid.appendChild(dayHeader); }); for (let i = 0; i < firstDay; i++) { dom.calendarGrid.appendChild(document.createElement('div')); } for (let day = 1; day <= daysInMonth; day++) { const dayCell = document.createElement('div'); const date = new Date(year, monthIndex, day); const dayOfWeek = date.getDay(); dayCell.className = 'calendar-day p-2 rounded-lg border border-gray-200 flex flex-col justify-between h-24 sm:h-28'; let contentHTML = `<span class="font-bold">${day}</span>`; let city = null; let cityKey = ''; if (dayOfWeek === 6) { dayCell.classList.add('bg-blue-50', 'preorder-day'); city = 'Yamaguchi City'; cityKey = 'preorderYamaguchi'; } else if (dayOfWeek === 0) { dayCell.classList.add('bg-red-50', 'preorder-day'); city = 'Ube City'; cityKey = 'preorderUbe'; } else { dayCell.classList.add('bg-gray-50'); } dayCell.innerHTML = contentHTML + (city ? `<span class="text-sm font-semibold ${dayOfWeek === 6 ? 'text-blue-700' : 'text-red-700'} mt-auto">${city}</span>` : ''); if (city) { dayCell.addEventListener('click', () => { document.querySelectorAll('.calendar-day').forEach(d => d.classList.remove('selected')); dayCell.classList.add('selected'); const dateString = new Intl.DateTimeFormat(currentLang, { month: 'long', day: 'numeric' }).format(date); selectedPreOrder = { date: dateString, city: city }; dom.preorderStatus.textContent = translations[currentLang][cityKey].replace('{date}', dateString); }); } dom.calendarGrid.appendChild(dayCell); } }
        function renderMenu(items) { dom.menuList.innerHTML = ''; if (items.length === 0) { dom.menuList.innerHTML = `<p class="text-gray-600 col-span-full text-center">No matching dishes found.</p>`; return; } items.forEach(item => { const card = document.createElement('div'); card.className = 'menu-card bg-white rounded-lg shadow-md overflow-hidden flex flex-col'; const name = item[`name_${currentLang}`] || item.name_en; const description = item[`description_${currentLang}`] || item.description_en; card.innerHTML = `<div class="h-48 overflow-hidden"><img src="${item.imageUrl}" alt="${name}" class="w-full h-full object-cover"></div><div class="p-4 flex flex-col flex-grow"><h3 class="text-xl font-bold mb-2">${name}</h3><p class="text-gray-600 mb-4 text-sm flex-grow">${description}</p><div class="flex justify-between items-center mt-auto"><p class="text-lg font-bold text-green-600">Â¥${item.price.toLocaleString()}</p><button data-item-id="${item.id}" class="add-to-cart-button bg-green-100 text-green-700 font-semibold px-4 py-2 rounded-lg hover:bg-green-200 transition"><i class="fas fa-plus mr-2"></i>${translations[currentLang].addBtn || 'Add'}</button></div></div>`; dom.menuList.appendChild(card); }); }
        function addToCart(e) { const button = e.target.closest('.add-to-cart-button'); if (!button) return; const itemId = parseInt(button.dataset.itemId); const menuItem = menuItems.find(m => m.id === itemId); const existingCartItem = cart.find(item => item.id === itemId); if (existingCartItem) { existingCartItem.quantity++; } else { cart.push({ ...menuItem, quantity: 1 }); } updateCart(); button.innerHTML = `<i class="fas fa-check"></i> ${translations[currentLang].addedBtn || 'Added'}`; button.classList.add("bg-green-500", "text-white"); setTimeout(() => { button.innerHTML = `<i class="fas fa-plus mr-2"></i> ${translations[currentLang].addBtn || 'Add'}`; button.classList.remove("bg-green-500", "text-white"); }, 1500); }
        function updateCart() { if (cart.length === 0) { dom.cartItemsContainer.innerHTML = ''; dom.emptyCartMessage.classList.remove('hidden'); } else { dom.emptyCartMessage.classList.add('hidden'); dom.cartItemsContainer.innerHTML = ''; cart.forEach(t => { const e = document.createElement('div'); e.className = 'flex justify-between items-center py-3 border-b'; e.innerHTML = `<div class="flex-grow"><p class="font-semibold">${t[`name_${currentLang}`] || t.name_en}</p><p class="text-sm text-gray-600">Â¥${t.price.toLocaleString()}</p></div><div class="flex items-center space-x-3"><button class="quantity-change-button text-gray-500" data-item-id="${t.id}" data-change="-1">-</button><span>${t.quantity}</span><button class="quantity-change-button text-gray-500" data-item-id="${t.id}" data-change="1">+</button></div><p class="w-20 text-right font-semibold">Â¥${(t.price * t.quantity).toLocaleString()}</p>`; dom.cartItemsContainer.appendChild(e); }); } const t = cart.reduce((t, e) => t + e.price * e.quantity, 0); dom.cartTotalElement.textContent = `Â¥${t.toLocaleString()}`; const e = cart.reduce((t, e) => t + e.quantity, 0); dom.cartCountElements.forEach(t => { t.textContent = e; t.classList.toggle('hidden', e === 0); }); dom.checkoutButton.disabled = cart.length === 0; }
        function handleQuantityChange(e) { const t = e.target.closest('.quantity-change-button'); if (!t) return; const a = parseInt(t.dataset.itemId), n = parseInt(t.dataset.change), s = cart.findIndex(t => t.id === a); s > -1 && (cart[s].quantity += n, cart[s].quantity <= 0 && cart.splice(s, 1)); updateCart(); }
        function openCart() { dom.cartSidebar.classList.remove('translate-x-full'); }
        function closeCart() { dom.cartSidebar.classList.add('translate-x-full'); }
        async function openCheckoutModal() { const total = cart.reduce((t, e) => t + e.price * e.quantity, 0); dom.checkoutTotalElement.textContent = `Â¥${total.toLocaleString()}`; if (currentUser) { const userDoc = await getDoc(doc(db, "users", currentUser.uid)); if (userDoc.exists()) { const userData = userDoc.data(); document.getElementById('customer-name').value = userData.name || ''; document.getElementById('customer-phone').value = userData.phone || ''; document.getElementById('customer-address').value = userData.address || ''; } document.getElementById('customer-email').value = currentUser.email; } else { dom.checkoutForm.reset(); } dom.checkoutModal.classList.remove('hidden'); document.body.style.overflow = 'hidden'; setTimeout(() => document.getElementById('checkout-modal-content').classList.remove('scale-95'), 10); }
        function closeCheckoutModal() { document.getElementById('checkout-modal-content').classList.add('scale-95'); dom.checkoutModal.classList.add('hidden'); document.body.style.overflow = 'auto'; dom.formError.classList.add('hidden'); }
        async function handleOrderSubmit(e) { e.preventDefault(); const confirmButton = document.getElementById('confirm-order-button'); if (!dom.checkoutForm.checkValidity()) { dom.formError.classList.remove('hidden'); return; } dom.formError.classList.add('hidden'); const originalButtonText = confirmButton.innerHTML; confirmButton.disabled = true; confirmButton.innerHTML = `<i class="fas fa-spinner fa-spin mr-2"></i>Loading...`; if (!db) { alert(translations[currentLang].dbError); confirmButton.disabled = false; confirmButton.innerHTML = originalButtonText; return; } const formData = new FormData(dom.checkoutForm); const customerDetails = Object.fromEntries(formData.entries()); const orderItems = cart.map(item => ({ name: item.name_en, quantity: item.quantity, price: item.price })); const orderTotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0); const orderData = { customerInfo: customerDetails, items: orderItems, total: orderTotal, createdAt: serverTimestamp(), userId: currentUser ? currentUser.uid : 'guest' }; if (selectedPreOrder.date) { orderData.preOrderInfo = selectedPreOrder; } try { const saveDataPromise = addDoc(collection(db, "orders"), orderData); const minDelayPromise = new Promise(resolve => setTimeout(resolve, 2000)); await Promise.all([saveDataPromise, minDelayPromise]); closeCheckoutModal(); showSuccessModal(); closeCart(); cart = []; selectedPreOrder = { date: null, city: null }; dom.preorderStatus.textContent = ''; document.querySelectorAll('.calendar-day.selected').forEach(d => d.classList.remove('selected')); updateCart(); dom.checkoutForm.reset(); } catch (err) { console.error("Error saving order: ", err); alert(translations[currentLang].orderError); } finally { confirmButton.disabled = false; confirmButton.innerHTML = originalButtonText; } }
        function showSuccessModal() { dom.successModal.classList.remove('hidden'); }
        function closeSuccessModal() { dom.successModal.classList.add('hidden'); }
        function openAdminPanel() { const t = prompt("Enter admin password:"); if (t === "admin123") { if (!db) { alert("Database connection error."); return; } dom.adminModal.classList.remove('hidden'); document.body.style.overflow = 'hidden'; loadOrders(); } else if (t) { alert("Incorrect password."); } }
        function closeAdminPanel() { dom.adminModal.classList.add('hidden'); document.body.style.overflow = 'auto'; }
        function loadOrders() { if (!db) return; const t = query(collection(db, "orders"), orderBy("createdAt", "desc")); onSnapshot(t, t => { if (t.empty) { dom.orderListContainer.innerHTML = '<p class="text-center text-gray-500">No orders yet.</p>'; return; } dom.orderListContainer.innerHTML = ''; t.forEach(t => { const e = t.data(), a = document.createElement('div'); a.className = "bg-white p-4 rounded-lg shadow mb-4"; const n = e.items.map(t => `<li>${t.name} (x${t.quantity}) - Â¥${(t.price * t.quantity).toLocaleString()}</li>`).join(''); let s = ''; e.preOrderInfo && (s = `<div class="mt-2 p-2 bg-green-100 rounded-md"><p class="font-semibold text-green-800">Pre-Order: ${e.preOrderInfo.date} (for ${e.preOrderInfo.city})</p></div>`); a.innerHTML = ` <div class="flex justify-between items-start"> <div> <p class="font-bold text-lg">Order ID: ${t.id}</p> <p class="text-sm text-gray-500">Date: ${e.createdAt ? e.createdAt.toDate().toLocaleString("en-US") : 'N/A'}</p> </div> <p class="font-bold text-xl text-green-600">Total: Â¥${e.total.toLocaleString()}</p> </div> ${s} <div class="mt-4 border-t pt-4"> <h4 class="font-semibold">Customer Info:</h4> <p><strong>Name:</strong> ${e.customerInfo.name}</p> <p><strong>Phone:</strong> ${e.customerInfo.phone}</p> <p><strong>Email:</strong> ${e.customerInfo.email}</p> <p><strong>Address:</strong> ${e.customerInfo.address}</p> </div> <div class="mt-4 border-t pt-4"> <h4 class="font-semibold">Order Details:</h4> <ul class="list-disc list-inside">${n}</ul> </div> `; dom.orderListContainer.appendChild(a); }); }); }
        function filterMenu() { const query = dom.searchBar.value.toLowerCase(); const filtered = menuItems.filter(item => (item.name_en.toLowerCase().includes(query) || item.name_ja.toLowerCase().includes(query) || item.name_id.toLowerCase().includes(query))); renderMenu(filtered); }
        
        // --- Event Listener Bindings ---
        const savedLang = localStorage.getItem('language') || 'en'; updateLanguage(savedLang); dom.cartCountElements.forEach(t => t.classList.add('hidden'));
        if(auth) {
            onAuthStateChanged(auth, async (user) => { if (user) { currentUser = user; const userDoc = await getDoc(doc(db, "users", user.uid)); const userName = userDoc.exists() && userDoc.data().name ? userDoc.data().name.split(' ')[0] : 'User'; dom.welcomeMessage.textContent = `${translations[currentLang].welcome || 'Welcome'}, ${userName}!`; dom.authLinks.classList.add('hidden'); dom.userLinks.classList.remove('hidden'); } else { currentUser = null; dom.authLinks.classList.remove('hidden'); dom.userLinks.classList.add('hidden'); } });
            document.getElementById('signup-form').addEventListener('submit', async (e) => { e.preventDefault(); const name = e.target['signup-name'].value; const email = e.target['signup-email'].value; const password = e.target['signup-password'].value; try { const userCredential = await createUserWithEmailAndPassword(auth, email, password); await setDoc(doc(db, "users", userCredential.user.uid), { name: name, email: email, phone: '', address: '' }); closeAuthModal('signup-modal'); } catch (error) { showAuthError('signup', error.message); } });
            document.getElementById('login-form').addEventListener('submit', async (e) => { e.preventDefault(); const email = e.target['login-email'].value; const password = e.target['login-password'].value; try { await signInWithEmailAndPassword(auth, email, password); closeAuthModal('login-modal'); } catch (error) { showAuthError('login', error.message); } });
            document.getElementById('logout-button').addEventListener('click', () => { signOut(auth); });
            document.getElementById('account-form').addEventListener('submit', async (e) => { e.preventDefault(); if (!currentUser) return; const name = e.target['account-name'].value; const phone = e.target['account-phone'].value; const address = e.target['account-address'].value; try { await setDoc(doc(db, "users", currentUser.uid), { name, phone, address }, { merge: true }); const successMsg = document.getElementById('account-success'); successMsg.classList.remove('hidden'); setTimeout(() => successMsg.classList.add('hidden'), 3000); } catch (error) { showAuthError('account', error.message); } });
            document.getElementById('account-button').addEventListener('click', async () => { if (!currentUser) return; const userDoc = await getDoc(doc(db, "users", currentUser.uid)); if (userDoc.exists()) { const data = userDoc.data(); document.getElementById('account-name').value = data.name || ''; document.getElementById('account-phone').value = data.phone || ''; document.getElementById('account-address').value = data.address || ''; } openAuthModal('account-modal'); });
        }
        dom.menuList.addEventListener('click', addToCart);
        dom.languageSwitcher.addEventListener('click', (e) => { const lang = e.target.closest('.lang-btn')?.dataset.lang; if(lang) updateLanguage(lang); });
        document.getElementById('signup-button').addEventListener('click', () => openAuthModal('signup-modal')); document.getElementById('close-signup-modal-button').addEventListener('click', () => closeAuthModal('signup-modal'));
        document.getElementById('login-button').addEventListener('click', () => openAuthModal('login-modal')); document.getElementById('close-login-modal-button').addEventListener('click', () => closeAuthModal('login-modal'));
        document.getElementById('close-account-modal-button').addEventListener('click', () => closeAuthModal('account-modal'));
        dom.closeCheckoutModalButton.addEventListener('click', closeCheckoutModal); dom.checkoutModal.addEventListener('click', e => e.target === dom.checkoutModal && closeCheckoutModal());
        dom.closeSuccessModalButton.addEventListener('click', closeSuccessModal);
        dom.cartButton.addEventListener('click', openCart); dom.mobileCartButton.addEventListener('click', openCart); dom.closeCartButton.addEventListener('click', closeCart);
        dom.cartItemsContainer.addEventListener('click', handleQuantityChange);
        dom.checkoutButton.addEventListener('click', openCheckoutModal);
        dom.checkoutForm.addEventListener('submit', handleOrderSubmit);
        dom.searchBar.addEventListener('input', filterMenu);
        dom.adminPanelButton.addEventListener('click', openAdminPanel);
        dom.closeAdminModalButton.addEventListener('click', closeAdminPanel);
    });
    </script>
</body>
</html>
